{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jaina/OneDrive/Documents/GitHub/Rentify/backend/api/rentals/checkout/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { stripe } from '../../lib/stripe.js';\nimport dbConnect from '../../lib/mongodb.js';\nimport Rental from '../../models/Rental.js';\n\nexport async function POST(req) {\n  try {\n    if (!stripe) {\n      return NextResponse.json(\n        { message: 'Stripe is not configured. Set STRIPE_SECRET_KEY in .env' },\n        { status: 503 }\n      );\n    }\n\n    const body = await req.json();\n    const rentalId = body?.rentalId;\n    const totalAmount = typeof body?.totalAmount === 'number' ? body.totalAmount : parseFloat(body?.totalAmount);\n\n    if (!rentalId || totalAmount == null || Number.isNaN(totalAmount)) {\n      return NextResponse.json({ message: 'Missing or invalid rentalId or totalAmount' }, { status: 400 });\n    }\n\n    await dbConnect();\n    const rental = await Rental.findById(rentalId).populate('product', 'title securityDeposit');\n    if (!rental) {\n      return NextResponse.json({ message: 'Rental not found' }, { status: 404 });\n    }\n    const deposit = Number(rental.securityDeposit) || Number(rental.product?.securityDeposit) || 0;\n    const amountToCharge = totalAmount + deposit;\n    const amountCents = Math.round(amountToCharge * 100);\n    if (amountCents < 50) {\n      return NextResponse.json(\n        { message: 'Minimum charge is $0.50 (50 cents)' },\n        { status: 400 }\n      );\n    }\n\n    const baseUrl =\n      process.env.NEXT_PUBLIC_APP_URL ||\n      (process.env.VERCEL_URL ? `https://${process.env.VERCEL_URL}` : null) ||\n      'http://localhost:3000';\n\n    const session = await stripe.checkout.sessions.create({\n      mode: 'payment',\n      payment_method_types: ['card'],\n      line_items: [\n        {\n          price_data: {\n            currency: 'usd',\n            product_data: {\n              name: `Rental: ${rental.product?.title || 'Product Rental'}${deposit > 0 ? ` (incl. deposit $${deposit.toFixed(2)})` : ''}`,\n            },\n            unit_amount: amountCents,\n          },\n          quantity: 1,\n        },\n      ],\n      metadata: {\n        rentalId: rentalId.toString(),\n      },\n      success_url: `${baseUrl}/rentals/success?session_id={CHECKOUT_SESSION_ID}`,\n      cancel_url: `${baseUrl}/rentals/cancel`,\n    });\n\n    return NextResponse.json({ sessionId: session.id, url: session.url });\n  } catch (error) {\n    console.error('Checkout error:', error);\n    const message = error?.message || 'Checkout failed';\n    return NextResponse.json({ message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;;;;;;;;;;;;;;;;;;AAKO,eAAe,KAAK,GAAG;IAC5B,IAAI;QACF,IAAI,CAAC,QAAQ;YACX,OAAO,4JAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAA0D,GACrE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,WAAW,MAAM;QACvB,MAAM,cAAc,OAAO,MAAM,gBAAgB,WAAW,KAAK,WAAW,GAAG,WAAW,MAAM;QAEhG,IAAI,CAAC,YAAY,eAAe,QAAQ,OAAO,KAAK,CAAC,cAAc;YACjE,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAA6C,GAAG;gBAAE,QAAQ;YAAI;QACpG;QAEA,MAAM;QACN,MAAM,SAAS,MAAM,OAAO,QAAQ,CAAC,UAAU,QAAQ,CAAC,WAAW;QACnE,IAAI,CAAC,QAAQ;YACX,OAAO,4JAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAmB,GAAG;gBAAE,QAAQ;YAAI;QAC1E;QACA,MAAM,UAAU,OAAO,OAAO,eAAe,KAAK,OAAO,OAAO,OAAO,EAAE,oBAAoB;QAC7F,MAAM,iBAAiB,cAAc;QACrC,MAAM,cAAc,KAAK,KAAK,CAAC,iBAAiB;QAChD,IAAI,cAAc,IAAI;YACpB,OAAO,4JAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAqC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UACJ,6DACA,CAAC,QAAQ,GAAG,CAAC,UAAU,GAAG,CAAC,QAAQ,EAAE,QAAQ,GAAG,CAAC,UAAU,EAAE,GAAG,IAAI,KACpE;QAEF,MAAM,UAAU,MAAM,OAAO,QAAQ,CAAC,QAAQ,CAAC,MAAM,CAAC;YACpD,MAAM;YACN,sBAAsB;gBAAC;aAAO;YAC9B,YAAY;gBACV;oBACE,YAAY;wBACV,UAAU;wBACV,cAAc;4BACZ,MAAM,CAAC,QAAQ,EAAE,OAAO,OAAO,EAAE,SAAS,mBAAmB,UAAU,IAAI,CAAC,iBAAiB,EAAE,QAAQ,OAAO,CAAC,GAAG,CAAC,CAAC,GAAG,IAAI;wBAC7H;wBACA,aAAa;oBACf;oBACA,UAAU;gBACZ;aACD;YACD,UAAU;gBACR,UAAU,SAAS,QAAQ;YAC7B;YACA,aAAa,GAAG,QAAQ,iDAAiD,CAAC;YAC1E,YAAY,GAAG,QAAQ,eAAe,CAAC;QACzC;QAEA,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE,WAAW,QAAQ,EAAE;YAAE,KAAK,QAAQ,GAAG;QAAC;IACrE,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,MAAM,UAAU,OAAO,WAAW;QAClC,OAAO,4JAAY,CAAC,IAAI,CAAC;YAAE;QAAQ,GAAG;YAAE,QAAQ;QAAI;IACtD;AACF"}},
    {"offset": {"line": 150, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jaina/OneDrive/Documents/GitHub/Rentify/frontend/app/api/rentals/checkout/route.js"],"sourcesContent":["export { POST } from '../../../../../backend/api/rentals/checkout/route.js';\n"],"names":[],"mappings":";AAAA"}}]
}