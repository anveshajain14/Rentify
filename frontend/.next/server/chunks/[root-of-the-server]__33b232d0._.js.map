{"version":3,"sources":["../../../../backend/lib/mongodb.js","../../../../backend/models/User.js","../../../../backend/models/Product.js"],"sourcesContent":["import mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error('Please define the MONGODB_URI environment variable inside .env');\r\n}\r\n\r\nlet cached = global.mongoose;\r\n\r\nif (!cached) {\r\n  cached = global.mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n","import mongoose, { Schema } from 'mongoose';\r\n\r\nconst UserSchema = new Schema({\r\n  name: { type: String, required: true },\r\n  email: { type: String, required: true, unique: true },\r\n  password: { type: String, required: true },\r\n  role: { type: String, enum: ['renter', 'seller', 'admin'], default: 'renter' },\r\n  avatar: { type: String, default: '' },\r\n  shopBanner: { type: String, default: '' },\r\n  bio: { type: String, default: '' },\r\n  location: { type: String, default: '' },\r\n  policies: { type: String, default: '' },\r\n  isApproved: { type: Boolean, default: false },\r\n  joinedAt: { type: Date, default: Date.now },\r\n  isBlocked: { type: Boolean, default: false },\r\n  // Email verification\r\n  isVerified: { type: Boolean, default: false },\r\n  emailVerificationOTP: { type: String, default: null },\r\n  otpExpiry: { type: Date, default: null },\r\n  otpResendCount: { type: Number, default: 0 },\r\n  otpResendWindow: { type: Date, default: null },\r\n  // Password reset\r\n  passwordResetToken: { type: String, default: null },\r\n  passwordResetExpiry: { type: Date, default: null },\r\n  // Login 2FA (optional)\r\n  loginOTP: { type: String, default: null },\r\n  loginOTPExpiry: { type: Date, default: null },\r\n  // Account lock after failed attempts\r\n  failedLoginAttempts: { type: Number, default: 0 },\r\n  lockedUntil: { type: Date, default: null },\r\n  // Invalidate all sessions on password reset\r\n  sessionVersion: { type: Number, default: 0 },\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.User || mongoose.model('User', UserSchema);\r\n","import mongoose, { Schema } from 'mongoose';\r\n\r\nconst ProductSchema = new Schema({\r\n  title: { type: String, required: true },\r\n  description: { type: String, required: true },\r\n  images: [{ type: String, required: true }],\r\n  category: { type: String, required: true },\r\n  pricePerDay: { type: Number, required: true },\r\n  pricePerWeek: { type: Number },\r\n  pricePerMonth: { type: Number },\r\n  seller: { type: Schema.Types.ObjectId, ref: 'User', required: true },\r\n  isApproved: { type: Boolean, default: false },\r\n  availability: [{\r\n    startDate: { type: Date },\r\n    endDate: { type: Date }\r\n  }],\r\n}, { timestamps: true });\r\n\r\nexport default mongoose.models.Product || mongoose.model('Product', ProductSchema);\r\n"],"names":[],"mappings":"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"}